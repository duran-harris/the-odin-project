<html>

<head>
	<title>Tic Tac Toe</title>
<style>
 #gameBoard {
	display: grid;   
        height: 100%;
        width: 100%; 
	grid-template-rows: 1fr 1fr 1fr;
	grid-template-columns: 1fr 1fr 1fr;
	     
 }

.gameTile {
   z-index: 2;
   height: 3fr;
   width: 3fr;
   border : 1px solid black;
}
</style>

</head>

<body>

<div id="header">
</div>

<div id="gameBoard">
<div class="gameTile" data-index="0">&nbsp;</div>
<div class="gameTile" data-index="1">&nbsp;</div>
<div class="gameTile" data-index="2">&nbsp;</div>

<div class="gameTile" data-index="3">&nbsp;</div>
<div class="gameTile" data-index="4">&nbsp;</div>
<div class="gameTile" data-index="5">&nbsp;</div>

<div class="gameTile" data-index="6">&nbsp;</div>
<div class="gameTile" data-index="7">&nbsp;</div>
<div class="gameTile" data-index="8">&nbsp;</div>

</div>

<script type="text/javascript">


function createGameBoard() {  
 const gameBoardTiles = [];
  for(i=0; i <9; i++) {
	gameBoardTiles[i] = createTile(i, null);    
  }

  const getGameBoardTiles = () => gameBoardTiles;
  const storeMove = (tileIndex, pPlayer) => gameBoardTiles[tileIndex].storeMove(pPlayer);
  const isVacantTile = (tileIndex) => gameBoardTiles[tileIndex] == null;
  const render = () => gameBoardTiles.forEach( (elem, index) => elem.render());
  const renderTile = (index) => gameBoardTiles[index].render();
  return {storeMove , isVacantTile, getGameBoardTiles, render, renderTile }; 
}

function createTile(index, player) {
   
  const render = () => {

   if(this.player != null && index != null) {
          document.querySelector(`.gameTile:nth-child(${index+1})`).innerHTML = this.player.icon;     
   }
  };
  const storeMove = (pPlayer) => {
    this.player = pPlayer;
  };

  return {index, player, render, storeMove};
}



const gameController = (function () {

 const playerOne = createPlayer('Player 1', 'X');
 const playerTwo = createPlayer('Player 2', 'O');
 const gameBoard = createGameBoard();
 let activePlayer = playerOne;

  const getGameBoard = () => gameBoard ;

  const checkWinConditionsMet = () => {
      return false;
  };
  
  const checkIfStalemate = () => {
      return false;
  };

  const checkIfDraw = () => {
     return false;
  };

  const renderGameBoard= () => {
        gameBoard.render();
  };

  const renderTile= (index) => {
        gameBoard.renderTile(index);
  };

  const endPlayerTurn = () => {
					//alert(`Before ending player turn: ${activePlayer .name} ${activePlayer.icon}`);					
					activePlayer  === playerOne ?activePlayer  = playerTwo: activePlayer  = playerOne;
					//alert(`After ending player turn: ${activePlayer.name} ${activePlayer.icon}`);
				  					    
				}
  const getActivePlayer = () => activePlayer ;
  const setActivePlayer = (player) => activePlayer = player;
  const storeMove = (index, player) => {
						//alert(`Storing move: ${index}`);
						getGameBoard().storeMove(index, player);
					};
 
 
 return {playerOne , playerTwo , getGameBoard , checkWinConditionsMet, checkIfStalemate, checkIfDraw, renderGameBoard , renderTile, endPlayerTurn , getActivePlayer , setActivePlayer, storeMove };

})();


  
  gameController.renderGameBoard();


function createStreak(streakStart, streakMiddle, streakEnd) {
 return {streakStart, streakMiddle, streakEnd};
}


function createPlayer(name, icon) { 
  const playerMovements = [];
  const playerStreaks = [];
  return {name, icon, playerMovements, playerStreaks};
}
  




let tileNodeList = document.querySelectorAll('div.gameTile');

for(let i=0; i < tileNodeList.length; i++) {
  
  let element = tileNodeList[i];
  element.addEventListener('click', function() {
	
        gameController.storeMove(i, gameController.getActivePlayer());
	gameController.renderTile(i);
        //If game not won yet end the current player's turn
        gameController.endPlayerTurn(gameController.getActivePlayer()) ;

	
       
  });

}
   




</script>



</body>

</html>